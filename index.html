<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mistral</title>
    <link rel="stylesheet" href="/assets/styles/main.css">
    <link rel="icon" href="/assets/images/favicon.png" type="image/png">
  </head>
  <body>
    <form onsubmit="ask(); return false">
      <input type="text" id="query" size="40" placeholder="Come posso aiutarti?">
      <button><span id="submit"> â–º </span></button>
      <div id="result"></div>
      <div id="loading"></div>
      <div id="info"></div>
    </form>
    <script>
      document.getElementById('query').addEventListener('keydown', event => {
        if (event.key === 'Enter') ask();
      });
      async function ask() {
        const q = document.getElementById("query").value;
        document.getElementById("result").innerHTML = "";
        document.getElementById("info").innerHTML = "";
        document.getElementById("loading").style.visibility = "visible";
        try {
          const res = await fetch("http://localhost:8008/query", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query: q })
          });
          //console.log("RES:", res);
          const data = await res.json();
          console.log("DATA:", data);
          if (!res.ok) {
            console.error('Error in fetched data, response was:', res);
            document.getElementById("result").innerHTML += data.message;
            return false;
          } else {
            document.getElementById("result").innerHTML += data.response;
            document.getElementById("info").innerHTML += "Tempo di risposta: " + data.total_time + " secondi<br />";
            document.getElementById("info").innerHTML += "Motivo della conclusione: " + data.finish_reason + "<br />";
          }
        } catch (error) {
          console.error('Error fetching data:', error);
          document.getElementById("result").innerHTML += 'Error fetching data: ' + error.message;
          return false;
        } finally {
          document.getElementById("loading").style.visibility = "hidden";
        }
        return false; // prevents the form from actually submitting
      }
    </script>
  </body>
</html>
